!function(m){"use strict";m.fn.editTable=function(t){var r,i,e,l=m.extend({data:[[""]],tableClass:"inputtable",jsonData:!1,headerCols:!1,maxRows:999,first_row:!0,row_template:!1,field_templates:!1,validate_field:function(t,e,a,n){return!0}},t),a=m(this),o="<thead><tr></tr></thead><tbody></tbody>",s=m("<table/>",{class:l.tableClass+(l.first_row?" wh":""),html:o}),f='<th><a class="addcol icon-button" href="#">+</a> <a class="delcol icon-button" href="#">-</a></th>',h=!0;function d(t,e){if(t=0===t?"0":t||"",e&&"text"!==e){var a=l.field_templates[e];return"<td>"+a.setValue(a.html,t)[0].outerHTML+"</td>"}return'<td><input type="text" value="'+t.toString().replace(/"/g,"&quot;")+'" /></td>'}function c(t,e){var a,n="";if(t=t||"",l.row_template)for(a=0;a<l.row_template.length;a+=1)n+=d(t[a],l.row_template[a]);else for(a=0;a<(e||t.length);a+=1)n+=d(t[a]);return m("<tr/>",{html:n+'<td><a class="addrow icon-button" href="#">+</a> <a class="delrow icon-button" href="#">-</a></td>'})}function u(){r<2&&s.find(".delcol").addClass("disabled"),i<2&&s.find(".delrow").addClass("disabled"),l.maxRows&&i===l.maxRows&&s.find(".addrow").addClass("disabled")}function n(t){var e=Math.min(l.maxRows,t.length);if(s.html(o),l.headerCols||l.row_template){for(var a=l.headerCols||l.row_template,n=0;n<a.length;n+=1){var d=l.headerCols[n]||"";s.find("thead tr").append("<th>"+d+"</th>")}for(n=0;n<e;n+=1)c(t[n],a.length).appendTo(s.find("tbody"))}else if(t[0]){for(n=0;n<t[0].length;n+=1)s.find("thead tr").append(f);for(n=0;n<e;n+=1)c(t[n]).appendTo(s.find("tbody"))}s.find("thead tr").append("<th></th>"),r=s.find("thead th").length-1,i=s.find("tbody tr").length,u()}function p(){var d,r=0,i=[];return h=!0,s.find("tbody tr").each(function(){i[r+=1]=[],m(this).find("td:not(:last-child)").each(function(t,e){var a,n;l.row_template&&"text"!==l.row_template[t]?(a=l.field_templates[l.row_template[t]],n=m(this).find(m(a.html).prop("tagName")),d=a.getValue(n),l.validate_field(t,d,l.row_template[t],n)||(h=!1)):(d=m(this).find('input[type="text"]').val(),l.validate_field(t,d,"text",e)||(h=!1)),i[r].push(d)})}),i.splice(0,1),i}if(a.is("textarea")){try{e=JSON.parse(a.val())}catch(t){throw t}a.after(s),0<s.parents("form").length&&s.parents("form").submit(function(){a.val(JSON.stringify(p()))})}else e=JSON.parse(l.jsonData)||l.data,a.append(s);return n(e),s.on("click",".addcol",function(){var t=parseInt(m(this).closest("tr").children().index(m(this).parent("th")),10);return r+=1,s.find("thead tr").find("th:eq("+t+")").after(f),s.find("tbody tr").each(function(){m(this).find("td:eq("+t+")").after(d())}),s.find(".delcol").removeClass("disabled"),!1}),s.on("click",".delcol",function(){if(m(this).hasClass("disabled"))return!1;var t=parseInt(m(this).closest("tr").children().index(m(this).parent("th")),10);return--r,u(),m(this).parent("th").remove(),s.find("tbody tr").each(function(){m(this).find("td:eq("+t+")").remove()}),!1}),s.on("click",".addrow",function(){return m(this).hasClass("disabled")||(i+=1,m(this).closest("tr").after(c(0,r)),s.find(".delrow").removeClass("disabled"),u()),!1}),s.on("click",".delrow",function(){return m(this).hasClass("disabled")||(--i,u(),m(this).closest("tr").remove(),s.find(".addrow").removeClass("disabled")),!1}),s.on("click","input",function(){m(this).select()}),{getData:p,getJsonData:function(){return JSON.stringify(p())},loadData:function(t){n(t)},loadJsonData:function(t){n(JSON.parse(t))},reset:function(){n(e)},isValidated:function(){return h}}}}(jQuery);