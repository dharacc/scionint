(function(){function s(t,e){return function(){return t.apply(e,arguments)}}var i,u,r,l,n=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};function t(t,e){this.opts=null!=e?e:{},this.sync_picker_with_select=s(this.sync_picker_with_select,this),this.select=jQuery(t),this.multiple="multiple"===this.select.attr("multiple"),null!=this.select.data("limit")&&(this.opts.limit=parseInt(this.select.data("limit"))),this.build_and_append_picker()}function e(t,e,i){this.picker=e,this.opts=null!=i?i:{},this.clicked=s(this.clicked,this),this.option=jQuery(t),this.create_node()}jQuery.fn.extend({imagepicker:function(e){return null==e&&(e={}),this.each(function(){var t=jQuery(this);if(t.data("picker")&&t.data("picker").destroy(),t.data("picker",new i(this,l(e))),null!=e.initialized)return e.initialized.call(t.data("picker"))})}}),l=function(t){var e={hide_select:!0,show_label:!1,initialized:void 0,changed:void 0,clicked:void 0,selected:void 0,limit:void 0,limit_reached:void 0,font_awesome:!1};return jQuery.extend(e,t)},r=function(t,e){var i,s,l,r;if(!t||!e||t.length!==e.length)return!1;for(t=t.slice(0),e=e.slice(0),t.sort(),e.sort(),i=s=0,l=t.length;s<l;i=++s)if(r=t[i],e[i]!==r)return!1;return!0},t.prototype.destroy=function(){for(var t=this.picker_options,e=0,i=t.length;e<i;e++)t[e].destroy();return this.picker.remove(),this.select.off("change",this.sync_picker_with_select),this.select.removeData("picker"),this.select.show()},t.prototype.build_and_append_picker=function(){return this.opts.hide_select&&this.select.hide(),this.select.on("change",this.sync_picker_with_select),null!=this.picker&&this.picker.remove(),this.create_picker(),this.select.after(this.picker),this.sync_picker_with_select()},t.prototype.sync_picker_with_select=function(){for(var t,e=this.picker_options,i=[],s=0,l=e.length;s<l;s++)(t=e[s]).is_selected()?i.push(t.mark_as_selected()):i.push(t.unmark_as_selected());return i},t.prototype.create_picker=function(){return this.picker=jQuery("<ul class='thumbnails image_picker_selector'></ul>"),this.picker_options=[],this.recursively_parse_option_groups(this.select,this.picker),this.picker},t.prototype.recursively_parse_option_groups=function(l,t){for(var e,i,s,r,n,c,o,a=l.children("optgroup"),h=0,p=a.length;h<p;h++)n=a[h],n=jQuery(n),(e=jQuery("<ul></ul>")).append(jQuery("<li class='group_title'>"+n.attr("label")+"</li>")),t.append(jQuery("<li class='group'>").append(e)),this.recursively_parse_option_groups(n,e);for(o=[],i=0,s=(c=function(){for(var t=l.children("option"),e=[],i=0,s=t.length;i<s;i++)r=t[i],e.push(new u(r,this,this.opts));return e}.call(this)).length;i<s;i++)r=c[i],this.picker_options.push(r),r.has_image()&&o.push(t.append(r.node));return o},t.prototype.has_implicit_blanks=function(){var l;return 0<function(){for(var t=this.picker_options,e=[],i=0,s=t.length;i<s;i++)(l=t[i]).is_blank()&&!l.has_image()&&e.push(l);return e}.call(this).length},t.prototype.selected_values=function(){return this.multiple?this.select.val()||[]:[this.select.val()]},t.prototype.toggle=function(t,e){var i,s=this.selected_values(),l=t.value().toString();if(this.multiple?0<=n.call(this.selected_values(),l)?((i=this.selected_values()).splice(jQuery.inArray(l,s),1),this.select.val([]),this.select.val(i)):null!=this.opts.limit&&this.selected_values().length>=this.opts.limit?null!=this.opts.limit_reached&&this.opts.limit_reached.call(this.select):this.select.val(this.selected_values().concat(l)):this.has_implicit_blanks()&&t.is_selected()?this.select.val(""):this.select.val(l),!r(s,this.selected_values())&&(this.select.change(),null!=this.opts.changed))return this.opts.changed.call(this.select,s,this.selected_values(),e)},i=t,e.prototype.destroy=function(){return this.node.find(".thumbnail").off("click",this.clicked)},e.prototype.has_image=function(){return null!=this.option.data("img-src")},e.prototype.is_blank=function(){return!(null!=this.value()&&""!==this.value())},e.prototype.is_selected=function(){var t=this.picker.select.val();return this.picker.multiple?0<=jQuery.inArray(this.value(),t):this.value()===t},e.prototype.mark_as_selected=function(){return this.node.find(".thumbnail").addClass("selected")},e.prototype.unmark_as_selected=function(){return this.node.find(".thumbnail").removeClass("selected")},e.prototype.value=function(){return this.option.val()},e.prototype.label=function(){return this.option.data("img-label")?this.option.data("img-label"):this.option.text()},e.prototype.clicked=function(t){if(this.picker.toggle(this,t),null!=this.opts.clicked&&this.opts.clicked.call(this.picker.select,this,t),null!=this.opts.selected&&this.is_selected())return this.opts.selected.call(this.picker.select,this,t)},e.prototype.create_node=function(){var t,e,i,s;return this.node=jQuery("<li/>"),this.option.data("font_awesome")?(t=jQuery("<i>")).attr("class","fa-fw "+this.option.data("img-src")):(t=jQuery("<img class='image_picker_image'/>")).attr("src",this.option.data("img-src")),s=jQuery("<div class='thumbnail'>"),(i=this.option.data("img-class"))&&(this.node.addClass(i),t.addClass(i),s.addClass(i)),(e=this.option.data("img-alt"))&&t.attr("alt",e),s.on("click",this.clicked),s.append(t),this.opts.show_label&&s.append(jQuery("<p/>").html(this.label())),this.node.append(s),this.node},u=e}).call(this);