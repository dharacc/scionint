function elementDraggable(){jQuery(".chl-element-sortable").sortable({scroll:!1,cursor:"move",connectWith:".chl-element-sortable",opacity:.7,helper:"original",placeholder:"chl-element-sortable-placeholder",start:function(e,a){var t=a.item.html();a.placeholder.html(t)},sort:function(e,a){elementActionHideShow()},stop:function(e,a){elementActionHideShow()}}).disableSelection(),jQuery(".chl-elements-list .chl-sortable-item").draggable({scroll:!1,cursor:"move",opacity:.7,stack:".chl-sortable-item",helper:"clone"}),jQuery(".chl-element-sortable").droppable({accept:".chl-elements-list .chl-sortable-item",drop:function(e,a){var t=jQuery(this),l=a.draggable,n=a.draggable.find(".chl-element-content").data("element_title"),r=a.draggable.find(".chl-element-content").data("element_id"),i=[];i.unshift({element_id:r,element_title:n});var c=JSON.stringify(i);l.clone().appendTo(t).find(".chl-element-content").attr("data-element_data",c),elementActionHideShow()}})}function elementActionHideShow(){jQuery(".chl-element-sortable").each(function(){jQuery(this).find(".chl-sortable-item").length+jQuery(this).find(".chl-element-sortable-placeholder").length<=0?jQuery(this).removeClass("chl-has-elements"):jQuery(this).addClass("chl-has-elements")})}function get_element_field(l,n){if(l){var r=classes=value=element_value=$data_attr="";switch(n&&null!=n[l.param_name]&&(value=n[l.param_name]),l.default&&(value=value||l.default),null!=l.classes&&(classes=l.classes),l.dependency&&(jQuery.each(l.dependency,function(e,a){"element"==e?element_name=a:"value"==e&&(element_value=JSON.stringify(a))}),dependency=JSON.stringify(l.dependency),$data_attr="data-dependency-element='"+element_name+"' data-dependency-value='"+element_value+"'"),r+="<div class='chl-field-option' data-content='"+l.group+"' "+$data_attr+">",r+='<div class="chl-field-label">'+l.heading+"</div>",r+='<div class="chl-field-input-cover '+l.type+'">',l.type){case"pgscore_range_slider":min=""!=l.min?l.min:0,max=""!=l.max?l.max:100,unit=""!=l.unit?l.unit:"",l.label&&(r+='<label class="chl-radio-label pgs-range-slider" for="'+l.param_name+'">',r+=l.label,r+="</label>"),r+='<input type="hidden" class="pgscore_range_slider chl-field-input" name="'+l.param_name+'" value="'+value+'">',r+='<div class="pgscore-range-slider" data-min_value="'+min+'" data-max_value="'+max+'" data-unit="'+unit+'"></div>';break;case"textarea_html":data=decodeURIComponent(value),data2=data,r+='<textarea id="textarea_html" name="'+l.param_name+'">'+data2+"</textarea>";break;case"textfield":var e="";l.placeholder&&(e=l.placeholder),r+='<input class="chl-field-input chl-field-textfield textfield" type="text" placeholder="'+e+'" name="'+l.param_name+'" value="'+value+'"/>';break;case"dropdown":multiple="",value=value.split(", "),dropdownClass="chl-field-input chl-field-dropdown dropdown",l.multiple&&(multiple=' multiple="multiple"'),l.enable_select2&&(dropdownClass+=" select2-enabled"),r+='<select class="'+dropdownClass+'" name="'+l.param_name+'"'+multiple+">",jQuery.each(l.options,function(e,a){var t="";-1!==jQuery.inArray(e,value)&&(t="selected"),r+='<option value="'+e+'" '+t+">"+a+"</option>"}),r+="</select>";break;case"checkbox":var a="";value&&(a="checked"),r+='<label class="chl-label chl-checkout-label" for="'+l.param_name+'">',r+='<input type="checkbox" id="'+l.param_name+'" value="true" class="chl-field-input chl-checkbox '+classes+'" name="'+l.param_name+'" '+a+">",r+='<span class="chl-checkout-title">'+l.options+"</span>",r+="</label>";break;case"checkbox_multi":jQuery.each(l.options,function(e,a){var t="";(n[e]||a.default)&&(t="checked"),r+='<label class="chl-label chl-checkout-label" for="'+e+'">',r+='<input type="checkbox" id="'+e+'" value="true" class="chl-field-input chl-checkbox '+classes+'" name="'+e+'" '+t+">",r+='<span class="chl-checkout-title">'+a.heading+"</span>",r+="</label>"});break;case"radio_buttonset":jQuery.each(l.options,function(e,a){var t="";e==value&&(t="checked"),r+='<label class="chl-label chl-radio-label" for="'+l.param_name+"-"+e+'">',r+='<input type="radio" id="'+l.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio '+classes+'" name="'+l.param_name+'" '+t+">",r+='<span class="chl-radio-title">'+a+"</span>",r+="</label>"});break;case"radio_image":jQuery.each(l.options,function(e,a){var t="";e==value&&(t="checked"),r+='<label class="chl-label chl-radio-label" for="'+l.param_name+"-"+e+'">',r+='<input type="radio" id="'+l.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio '+classes+'" name="'+l.param_name+'" '+t+">",r+='<span class="chl-radio-title"><img class="radio_image_picker" src="'+a+'"></span>',r+="</label>"});break;case"radio":jQuery.each(l.options,function(e,a){var t="";e==value&&(t="checked"),r+='<label class="chl-label chl-radio-label" for="'+l.param_name+"-"+e+'">',r+='<input type="radio" id="'+l.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio-button '+classes+'" name="'+l.param_name+'" '+t+">",r+='<span class="chl-radio-title">'+a+"</span>",r+="</label>"});break;case"radio_icon":jQuery.each(l.options,function(e,a){var t="";e==value&&(t="checked"),r+='<label class="chl-label chl-radio-label" for="'+l.param_name+"-"+e+'">',r+='<input type="radio" id="'+l.param_name+"-"+e+'" value="'+e+'" class="chl-field-input chl-radio '+classes+'" name="'+l.param_name+'" '+t+">",r+='<span class="chl-radio-title">'+a+"</span>",r+="</label>"});break;case"colorpicker":r+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" data-alpha="true" type="text" placeholder="" name="'+l.param_name+'" value="'+value+'"/>';break;case"background_settings":var t={},i=null==n[l.param_name+"_bg_src"]?"hidden":"",c=null!=n[l.param_name+"_bg_image"]?n[l.param_name+"_bg_image"]:"",s=null!=n[l.param_name+"_bg_src"]?n[l.param_name+"_bg_src"]:"",o=null!=n[l.param_name+"_bg_color"]?n[l.param_name+"_bg_color"]:"",d=null!=n[l.param_name+"_bg_repeat"]?n[l.param_name+"_bg_repeat"]:"inherit",h=null!=n[l.param_name+"_bg_size"]?n[l.param_name+"_bg_size"]:"inherit",u=null!=n[l.param_name+"_bg_attachment"]?n[l.param_name+"_bg_attachment"]:"inherit",m=null!=n[l.param_name+"_bg_position"]?n[l.param_name+"_bg_position"]:"inherit";r+='<div class="chl-background-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_bg_image"> <span class="chl-label-title">'+chl.upload_image+"</span> </label>",r+='<div class="chl-field-media-cover '+i+'">',s&&(r+='<img src="'+s+'">'),r+="</div>",r+='<input class="chl-field-input button chl-button button-large chl-field-media media-upload" id="'+l.param_name+'_bg_image" type="button" value="Upload"/>',r+='<input class="chl-field-input button chl-button button-large chl-remove-media-button '+i+'" type="button" value="Remove"/>',r+='<input class="chl-field-input chl-field-media-id hidden" type="text" name="'+l.param_name+'_bg_image" value="'+c+'"/>',r+='<input class="chl-field-input chl-field-media-src hidden" type="text" name="'+l.param_name+'_bg_src" value="'+s+'"/>',r+="</div>",r+='<div class="chl-background-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_bg_color"> <span class="chl-label-title">'+chl.color+"</span> </label>",r+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" data-alpha="true" id="'+l.param_name+'_bg_color" type="text" name="'+l.param_name+'_bg_color" value="'+o+'"/>',r+="</div>",r+='<div class="chl-background-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_bg_repeat"> <span class="chl-label-title">'+chl.image_repeat+"</span> </label>",r+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+l.param_name+'_bg_repeat" name="'+l.param_name+'_bg_repeat">',t={inherit:"Inherit","no-repeat":"No repeat",repeat:"Repeat All","repeat-x":"Repeat Horizontally","repeat-y":"Repeat Vertically"},jQuery.each(t,function(e,a){r+=d==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),r+="</select>",r+="</div>",r+='<div class="chl-background-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_bg_size"> <span class="chl-label-title">'+chl.image_size+"</span> </label>",r+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+l.param_name+'_bg_size" name="'+l.param_name+'_bg_size">',t={inherit:"Inherit",cover:"Cover",contain:"Contain"},jQuery.each(t,function(e,a){r+=h==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),r+="</select>",r+="</div>",r+='<div class="chl-background-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_bg_attachment"> <span class="chl-label-title">'+chl.image_attachment+"</span> </label>",r+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+l.param_name+'_bg_attachment" name="'+l.param_name+'_bg_attachment">',t={inherit:"Inherit",fixed:"Fixed",scroll:"Scroll"},jQuery.each(t,function(e,a){r+=u==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),r+="</select>",r+="</div>",r+='<div class="chl-background-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_bg_position"> <span class="chl-label-title">'+chl.image_position+"</span> </label>",r+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+l.param_name+'_bg_position" name="'+l.param_name+'_bg_position">',t={inherit:"Inherit","left top":"Left Top","left center":"Left Center","left bottom":"Left Bottom","center top":"Center Top","center center":"Center Center","center bottom":"Center Bottom","right top":"Right Top","right center":"Right Center","right bottom":"Right Bottom"},jQuery.each(t,function(e,a){r+=m==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),r+="</select>",r+="</div>";break;case"color_settings":var p=null!=n[l.param_name+"_color"]?n[l.param_name+"_color"]:"",v=null!=n[l.param_name+"_link_color"]?n[l.param_name+"_link_color"]:"",_=null!=n[l.param_name+"_hover_color"]?n[l.param_name+"_hover_color"]:"";0!=l.text_color&&(r+='<div class="chl-color-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_color"> <span class="chl-label-title">'+chl.text_color+"</span> </label>",r+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+l.param_name+'_color" value="'+p+'"/>',r+="</div>"),0!=l.link_color&&(r+='<div class="chl-color-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_link_color"> <span class="chl-label-title">'+chl.link_color+"</span> </label>",r+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+l.param_name+'_link_color" value="'+v+'"/>',r+="</div>"),0!=l.hover_color&&(r+='<div class="chl-color-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_hover_color"> <span class="chl-label-title">'+chl.link_hover_color+"</span> </label>",r+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+l.param_name+'_hover_color" value="'+_+'"/>',r+="</div>");break;case"border_settings":var y=null!=n[l.param_name+"_width"]?n[l.param_name+"_width"]:0,p=null!=n[l.param_name+"_color"]?n[l.param_name+"_color"]:"",f=null!=n[l.param_name+"_style"]?n[l.param_name+"_style"]:"solid";boder_width=null!=n[l.param_name+"_border_width"]?n[l.param_name+"_border_width"]:"full_width",r+='<div class="chl-border-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_width"> <span class="chl-label-title">'+chl.width+"</span> </label>",r+='<input class="chl-field-input chl-field-number" type="number" placeholder="" min="0" max="10" name="'+l.param_name+'_width" value="'+y+'"/>',r+="</div>",r+='<div class="chl-border-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_style"> <span class="chl-label-title">'+chl.style+"</span> </label>",r+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+l.param_name+'_style" name="'+l.param_name+'_style">',t={dotted:"Dotted",dashed:"Dashed",solid:"Solid",double:"Double",groove:"Groove",ridge:"Ridge",inset:"Inset",outset:"Outset",initial:"Initial",inherit:"Inherit"},jQuery.each(t,function(e,a){r+=f==e?'<option value="'+e+'" selected="selected">'+a+"</option>":'<option value="'+e+'">'+a+"</option>"}),r+="</select>",r+="</div>",r+='<div class="chl-border-setting-field">',r+='<label class="chl-label" for="'+l.param_name+'_border_width"><span class="chl-label-title">'+chl.border_width+"</span></label>",r+='<select class="chl-field-input chl-field-dropdown dropdown" id="'+l.param_name+'_border_width" name="'+l.param_name+'_border_width">',t={full_width:chl.full_width,container:chl.container},jQuery.each(t,function(e,a){boder_width==e?r+='<option value="'+e+'" selected="selected">'+a+"</option>":r+='<option value="'+e+'">'+a+"</option>"}),r+="</select>",r+="</div>",r+='<div class="chl-border-setting-field last-field">',r+='<label class="chl-label" for="'+l.param_name+'_color"> <span class="chl-label-title">'+chl.color+"</span> </label>",r+='<input class="chl-field-input chl-field-colorpicker colorpicker color-picker" type="text" placeholder="" name="'+l.param_name+'_color" value="'+p+'"/>',r+="</div>"}return r+="</div>",null!=l.description&&(r+='<span class="chl-description">'+l.description+"</span>"),r+="</div>"}}function fieldsActionHideShow(){jQuery(".chl-field-option").each(function(){var e=jQuery(".chl-edit-tabs .chl-tabs-title.chl-tab-active").data("tab");jQuery(this).data("content")==e?jQuery(this).show():jQuery(this).hide()}),formDataDependency()}function fieldsEditor(){wp.editor.initialize("textarea_html",{tinymce:{wpautop:!0},quicktags:!0,mediaButtons:!1})}function fieldsEditorRemove(){tinymce.get("textarea_html")&&wp.editor.remove("textarea_html")}function getRangeSlider(){jQuery(".pgscore-range-slider").each(function(){var e=jQuery(this).parent().find(".pgscore_range_slider").val(),a=jQuery(this).data("min_value"),t=jQuery(this).data("max_value"),l=jQuery(this).data("unit"),n=jQuery(this).parent().find("label.pgs-range-slider").text();jQuery(this).slider({range:"min",value:""!=e?e:10,min:a,max:t,slide:function(e,a){jQuery(this).parent().find(".pgscore_range_slider").val(a.value),jQuery(this).parent().find("label.pgs-range-slider").text(n+": "+a.value+l)}}),jQuery(this).parent().find("label.pgs-range-slider").text(n+": "+jQuery(this).slider("value")+l)})}function formDataDependency(){jQuery("form#header_builder_elements_form :input").each(function(){var e,a,t;this.checked&&(e=jQuery(this).val(),a=jQuery(this).attr("name"),t=jQuery(".chl-edit-tabs .chl-tabs-title.chl-tab-active").data("tab"),jQuery('[data-dependency-element="'+a+'"]').each(function(){dependency=jQuery(this).data("dependency-value"),dependency_tab=jQuery(this).data("content"),-1==jQuery.inArray(e,dependency)?jQuery(this).hide():dependency_tab==t&&jQuery(this).show()}))})}function setColorPicker(){jQuery(".color-picker").wpColorPicker()}function enableSelect2(){jQuery(".select2-enabled").select2({containerCssClass:"chl-gropdown-container"})}function device_related_elements(){var e=jQuery(".chl-toolbar-devices span.active-devices").data("device");e&&("desktop"==e&&(jQuery(".chl-element-for-mobile").hide(),jQuery(".chl-element-for-desktop").show()),"mobile"==e&&(jQuery(".chl-element-for-desktop").hide(),jQuery(".chl-element-for-mobile").show()))}jQuery(document).ready(function(){jQuery(".add-header-layout").on("click",function(e){e.preventDefault(),jQuery(".chl-preset-header-container").hasClass(".chl-header-list-active")?jQuery(".chl-preset-header-container").removeClass("chl-header-list-active"):jQuery(".chl-preset-header-container").addClass("chl-header-list-active")}),jQuery(".chl-preset-header-close").on("click",function(e){e.preventDefault(),jQuery(".chl-preset-header-container").removeClass("chl-header-list-active")}),jQuery(document).on("click",".header-layout",function(e){e.preventDefault();var a=jQuery(this).data("layout"),t=jQuery(this).find("a").attr("href");jQuery(this).parents(".chl-preset-header-inner").append('<div class="chl-loading"></div>'),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"add_sample_header",layout:a},dataType:"json",success:function(e){t+="&header_id="+e.header_id,jQuery(".chl-loading").remove(),jQuery(location).attr("href",t)}})}),device_related_elements(),jQuery(".chl-toolbar-devices span").on("click",function(){jQuery(this).hasClass("active-devices")||(jQuery(".chl-toolbar-devices span").removeClass("active-devices"),jQuery(this).addClass("active-devices"),"desktop"==jQuery(this).data("device")&&(jQuery(".chl-structure").removeClass("chl-structure-mobile"),jQuery(".chl-structure").addClass("chl-structure-desktop"),device_related_elements()),"mobile"==jQuery(this).data("device")&&(jQuery(".chl-structure").removeClass("chl-structure-desktop"),jQuery(".chl-structure").addClass("chl-structure-mobile"),device_related_elements()))}),jQuery(document).on("click",".chl-element-content .chl-remove-btn",function(){confirm("Are you sure to delete this element?")&&(jQuery(this).parents(".chl-sortable-item").remove(),elementActionHideShow())}),jQuery(document).on("click",".chl-element-content .chl-clone-btn",function(){var e=jQuery(this).parents(".chl-sortable-item").html();jQuery(this).parents(".chl-element-sortable").append('<li class="chl-sortable-item">'+e+"</li>")}),jQuery(document).on("click",".chl-element-sortable .chl-element-content-inner",function(){var e,a,t,n;jQuery(this).parents(".chl-element-content").hasClass("chl-element-current")||(jQuery(".chl-structure").append('<div class="chl-settings-loading"></div>'),jQuery(".chl-device-elements-settings").html(""),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row"),jQuery(this).parents(".chl-element-content").addClass("chl-element-current"),e=jQuery(this).parents(".chl-element-content").data("element_id"),a=jQuery(this).parents(".chl-element-content").data("element_title"),t=jQuery(this).parents(".chl-element-content").attr("data-element_data"),n="",null!=t&&""!=t&&(elements_data_arr=JSON.parse(t),n=[],jQuery.each(elements_data_arr,function(e,a){n[a.name]?n[a.name]=n[a.name]+", "+a.value:n[a.name]=a.value})),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"edit_element",elementId:e},dataType:"json",success:function(e){var t="",l="";$tabs=[],$active_tab=!0,jQuery.each(e,function(e,a){-1==jQuery.inArray(a.group,$tabs)&&$tabs.push(a.group),l+=get_element_field(a,n)}),t+='<div class="chl-element-settings"><div class="chl-element-settings-inner">',t+='<div class="chl-element-settings-header">',t+='<div class="chl-element-settings-close"><span class="dashicons dashicons-no"></span></div><div class="chl-element-settings-title">'+a+" "+chl.settings+"</div>",t+='<div class="chl-edit-tabs">',jQuery.each($tabs,function(e,a){$active_tab?(t+='<div class="chl-tabs-title chl-tab-active" data-tab="'+a+'">'+a+"</div>",$active_tab=!1):t+='<div class="chl-tabs-title" data-tab="'+a+'">'+a+"</div>"}),t+="</div>",t+="</div>",t+='<div class="chl-element-settings-content chl-element-settings-edit-content"><div class="chl-element-edit"><form id="header_builder_elements_form" method="get">',t+='<div class="chl-editor-fields">',t+=l,t+="</div>",t+='<div class="chl-edit-action-tabs">',t+='<a class="button button-primary button-large chl-save-element">'+chl.save+"</a>",t+='<a class="button button-secondary button-large chl-close-element">'+chl.cancel+"</a>",t+="</div>",t+="</from></div></div></div></div>",jQuery(".chl-settings-loading").remove(),jQuery(t).appendTo(".chl-device-elements-settings"),jQuery(".chl-device-elements-settings").addClass("chl-elements-settings-show"),fieldsEditorRemove(),fieldsEditor(),getRangeSlider(),fieldsActionHideShow(),formDataDependency(),setColorPicker(),enableSelect2()}}))}),jQuery(document).on("click",".chl-edit-tabs .chl-tabs-title",function(){jQuery(this).hasClass("chl-tab-active")||(jQuery(this).data("tab"),jQuery(".chl-edit-tabs .chl-tabs-title").removeClass("chl-tab-active"),jQuery(this).addClass("chl-tab-active"),fieldsActionHideShow())}),jQuery(document).on("click",".chl-popup-close, .chl-element-settings-close, .chl-popup-overlay, .chl-close-element, .chl-toolbar-devices",function(e){e.preventDefault(),jQuery(".chl-element-settings").remove(),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row")}),jQuery(document).on("click",".chl-save-element",function(e){e.preventDefault();var a=jQuery("#header_builder_elements_form").serializeArray(),t=jQuery(".chl-element-content.chl-element-current").data("element_id"),l=jQuery(".chl-element-content.chl-element-current").data("element_title");a.forEach(function(e){var a;"textarea_html"===e.name&&(a="",a=jQuery("#wp-textarea_html-wrap").hasClass("tmce-active")?tinymce.get("textarea_html").getContent():jQuery("textarea#textarea_html").val(),e.value=encodeURIComponent(a))}),a.unshift({element_id:t,element_title:l}),$element_json=JSON.stringify(a),jQuery(".chl-element-current").attr("data-element_data",$element_json),jQuery(".chl-element-settings").remove(),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row")}),jQuery(document).on("click",".chl-save",function(){if(""==jQuery(".layout-title").val())return jQuery(".layout-title").addClass("chl-required"),void jQuery("html, body").animate({scrollTop:jQuery(".layout-title").offset().top-100},1e3);jQuery(".layout-title").removeClass("chl-required");var n={};n.title=jQuery(".layout-title").val(),n.header_id=jQuery(this).data("header_id"),jQuery(".chl-elements-cover").each(function(){var l=jQuery(this).data("possition"),e=jQuery(this).data("element_data");n[l]={},n[l].configuration=[],n[l].configuration=e,jQuery(this).find(".chl-element-contents").each(function(){var t=jQuery(this).data("possition");n[l][t]=[],$i=0,jQuery(this).find(".chl-has-elements .chl-sortable-item").each(function(){var e=jQuery(this).find(".chl-element-content").data("element_id"),a=jQuery(this).find(".chl-element-content").data("element_data");n[l][t][$i]={},n[l][t][$i][e]=a,$i++})})}),jQuery("#wpwrap").append('<div class="chl-overlay"></div>'),jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"save_header_builder",objects:n},success:function(e){var a;jQuery(".chl-overlay").remove(),e.redirect&&(a=jQuery(location).attr("href"),a+="&header_id="+e.header_id,jQuery(location).attr("href",a))}})}),jQuery(document).on("click",".header-layout-clone",function(e){e.preventDefault();var a=jQuery(this).data("header_id");jQuery(this);""!=a&&jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"clone_header",headerId:a},dataType:"json",success:function(e){var a=jQuery(location);href=a.attr("protocol")+"//"+a.attr("host")+a.attr("pathname"),jQuery("ul.header-layout-lists").append('<li class="header-layout-list-item"><div class="header-layout-list-item-inner"><a href="'+href+"?page=header-layout&header_id="+e.header_id+'">'+e.header_title+'</a><div class="header-layout-list-actions"><a href="'+href+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-edit"><span class="dashicons dashicons-edit"></span></a><a href="'+href+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-clone" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-admin-page"></span></a><a href="'+href+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-delete" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-trash"></span></a></div></li>')}})}),jQuery(document).on("click",".header-layout-export",function(e){e.preventDefault();var a=jQuery(this).data("header_id");jQuery(this);""!=a&&jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"export_header",headerId:a},dataType:"json",success:function(e){var a;e&&((a=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e.file_content)),a.setAttribute("download",e.file_name),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a))}})});var t,e=document.querySelector(".chl-importer-holder"),n=document.getElementById("chl-importer-file");jQuery(document).on("click",".import-header-layout",function(e){e.preventDefault(),jQuery(".chl-importer-container").addClass("active-container"),jQuery(".chl-importer-file-name").remove(),n.files=null}),jQuery(document).on("click",".chl-importer-close, .chl-import-cancel",function(e){e.preventDefault(),jQuery(".chl-importer-container").removeClass("active-container"),jQuery(".chl-importer-file-name").remove(),n.files=null}),null!=e&&(e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("drop",function(e){e.preventDefault(),jQuery(".chl-importer-file-name").remove();var a=e.dataTransfer.files;"text/plain"==a[0].type&&(jQuery(".chl-importer-holder").find(".chl-importer-file").append('<label class="chl-importer-file-name">'+a[0].name+"</label>"),n.files=a)})),jQuery(document).on("change","#chl-importer-file",function(){jQuery(".chl-importer-file-name").remove();var e=jQuery(this).prop("files")[0];"text/plain"==e.type&&jQuery(".chl-importer-holder").find(".chl-importer-file").append('<label class="chl-importer-file-name">'+e.name+"</label>")}),jQuery(document).on("click",".chl-import-button",function(e){e.preventDefault();var a=jQuery("#chl-importer-file").prop("files")[0],t=new FormData;t.append("file",a),t.append("action","import_header"),console.log({form_data:t}),jQuery.ajax({type:"POST",url:ajaxurl,contentType:!1,processData:!1,data:t,dataType:"json",beforeSend:function(){jQuery(".chl-importer-loader").show()},success:function(e){var a,t,l;jQuery(".chl-importer-loader").hide(),e&&(a=jQuery("ul.header-layout-lists li").length,a-=2,l=(t=jQuery(location)).attr("protocol")+"//"+t.attr("host")+t.attr("pathname"),jQuery("ul.header-layout-lists > li:eq("+a+")").after('<li class="header-layout-list-item"><div class="header-layout-list-item-inner"><a href="'+l+"?page=header-layout&header_id="+e.header_id+'">'+e.header_title+'</a><div class="header-layout-list-actions"><a href="'+l+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-edit"><span class="dashicons dashicons-edit"></span></a><a href="'+l+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-clone" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-admin-page"></span></a><a href="'+l+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-export" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-upload"></span></a><a href="'+l+"?page=header-layout&header_id="+e.header_id+'" class="header-layout-action header-layout-delete" data-header_id="'+e.header_id+'"><span class="dashicons dashicons-trash"></span></a></div></li>')),jQuery("#chl-importer-file").val(null),jQuery(".chl-importer-close .dashicons").click(),jQuery(".chl-importer-file-name").remove(),n.files=null}})}),jQuery(document).on("click",".header-layout-delete",function(e){e.preventDefault();var a=jQuery(this).data("header_id"),t=jQuery(this);""!=a&&confirm("Are you sure to delete this header layout?")&&jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"delete_header",headerId:a},dataType:"json",success:function(e){t.parents("li").remove()}})}),jQuery(document).on("click",".chl-row-configure",function(){var a,e,n;jQuery(this).parents(".chl-elements-cover").hasClass("chl-current-row")||(jQuery(".chl-structure").append('<div class="chl-settings-loading"></div>'),jQuery(".chl-device-elements-settings").html(""),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-elements-cover").removeClass("chl-current-row"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(this).parents(".chl-elements-cover").addClass("chl-current-row"),a=jQuery(".chl-current-row").data("element_title"),e=jQuery(".chl-current-row").attr("data-element_data"),(n="")!=e&&(elements_data_arr=JSON.parse(e),n=[],jQuery.each(elements_data_arr,function(e,a){n[a.name]=a.value})),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"header_configure"},dataType:"json",success:function(e){var t="",l="";$tabs=[],$active_tab=!0,jQuery.each(e,function(e,a){-1==jQuery.inArray(a.group,$tabs)&&$tabs.push(a.group),l+=get_element_field(a,n)}),t+='<div class="chl-element-settings"><div class="chl-element-settings-inner">',t+='<div class="chl-element-settings-header">',t+='<div class="chl-element-settings-close"><span class="dashicons dashicons-no"></span></div><div class="chl-element-settings-title">'+chl.configure+" "+a+" "+chl.settings+"</div>",t+='<div class="chl-edit-tabs">',jQuery.each($tabs,function(e,a){$active_tab?(t+='<div class="chl-tabs-title chl-tab-active" data-tab="'+a+'">'+a+"</div>",$active_tab=!1):t+='<div class="chl-tabs-title" data-tab="'+a+'">'+a+"</div>"}),t+="</div>",t+="</div>",t+='<div class="chl-element-settings-content chl-element-settings-edit-content"><div class="chl-element-edit"><form id="header_builder_elements_form" method="get">',t+='<div class="chl-editor-fields">',t+=l,t+="</div>",t+='<div class="chl-edit-action-tabs">',t+='<a class="button button-primary button-large chl-save-configuration">'+chl.save+"</a>",t+='<a class="button button-secondary button-large chl-close-element">'+chl.cancel+"</a>",t+="</div>",t+="</from></div></div></div></div>",jQuery(".chl-settings-loading").remove(),jQuery(".chl-device-elements-settings").append(t),jQuery(".chl-device-elements-settings").addClass("chl-elements-settings-show"),getRangeSlider(),fieldsActionHideShow(),formDataDependency(),setColorPicker(),enableSelect2()}}))}),jQuery(document).on("click",".chl-save-configuration",function(){var e=jQuery("#header_builder_elements_form").serializeArray();$element_json=JSON.stringify(e),jQuery(".chl-current-row").attr("data-element_data",$element_json),jQuery(".chl-element-settings").remove(),jQuery(".chl-device-elements-settings").removeClass("chl-elements-settings-show"),jQuery(".chl-element-content").removeClass("chl-element-current"),jQuery(".chl-elements-cover").removeClass("chl-current-row")}),elementDraggable(),elementActionHideShow(),fieldsActionHideShow(),jQuery(".chl-field-colorpicker").wpColorPicker(),jQuery(document).on("click",".media-upload",function(e){e.preventDefault();var a=jQuery(this).parents(".chl-background-setting-field");t||(t=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image",close:!0},multiple:!1})).on("select",function(){var e=t.state().get("selection").first().toJSON();a.find(".chl-field-media-id").val(e.id),a.find(".chl-field-media-src").val(e.url),0<a.find(".chl-field-media-cover img").length?a.find(".chl-field-media-cover img").attr("src",e.url):a.find(".chl-field-media-cover").append('<img src="'+e.url+'"/>'),a.find(".chl-field-media-cover").removeClass("hidden"),a.find(".chl-remove-media-button").removeClass("hidden")}),t.open()}),jQuery(document).on("click",".chl-remove-media-button",function(){var e=jQuery(this).parents(".chl-background-setting-field");e.find(".chl-field-media-id").val(""),e.find(".chl-field-media-src").val(""),e.find(".chl-field-media-cover img").attr("src",""),e.find(".chl-field-media-cover").addClass("hidden"),jQuery(this).addClass("hidden")})}),jQuery(document).on("click",".chl-field-input",function(){var e=jQuery(this).val(),a=jQuery(this).attr("name"),t=jQuery(".chl-edit-tabs .chl-tabs-title.chl-tab-active").data("tab");jQuery('[data-dependency-element="'+a+'"]').each(function(){dependency=jQuery(this).data("dependency-value"),dependency_tab=jQuery(this).data("content"),-1==jQuery.inArray(e,dependency)?jQuery(this).hide():dependency_tab==t&&jQuery(this).show()})});